<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Contract Hosts | ERTP 0.x</title>
    <meta name="description" content="Electronic Rights Transfer Protocol (ERTP). A smart contract framework for exchanging electronic rights">
    
    
    <link rel="preload" href="/ERTP/assets/css/0.styles.4436858b.css" as="style"><link rel="preload" href="/ERTP/assets/js/app.1981f8d2.js" as="script"><link rel="preload" href="/ERTP/assets/js/2.a50c2bef.js" as="script"><link rel="preload" href="/ERTP/assets/js/12.ea92337c.js" as="script"><link rel="prefetch" href="/ERTP/assets/js/10.037a181b.js"><link rel="prefetch" href="/ERTP/assets/js/11.02dbf796.js"><link rel="prefetch" href="/ERTP/assets/js/13.1f75e680.js"><link rel="prefetch" href="/ERTP/assets/js/14.64734ebc.js"><link rel="prefetch" href="/ERTP/assets/js/15.667d7bf4.js"><link rel="prefetch" href="/ERTP/assets/js/16.62bc5a64.js"><link rel="prefetch" href="/ERTP/assets/js/3.2b21725d.js"><link rel="prefetch" href="/ERTP/assets/js/4.f22d64cd.js"><link rel="prefetch" href="/ERTP/assets/js/5.f39b2ce3.js"><link rel="prefetch" href="/ERTP/assets/js/6.ff03024e.js"><link rel="prefetch" href="/ERTP/assets/js/7.a5677fb4.js"><link rel="prefetch" href="/ERTP/assets/js/8.eb910c83.js"><link rel="prefetch" href="/ERTP/assets/js/9.5fe64c05.js">
    <link rel="stylesheet" href="/ERTP/assets/css/0.styles.4436858b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ERTP/" class="home-link router-link-active"><!----> <span class="site-name">ERTP 0.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ERTP/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/ERTP/api/" class="nav-link">API</a></div><div class="nav-item"><a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/Agoric/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ERTP/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/ERTP/api/" class="nav-link">API</a></div><div class="nav-item"><a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/Agoric/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/ERTP/guide/" class="sidebar-heading clickable router-link-active open"><span>Guide</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ERTP/guide/" class="sidebar-link">ERTP</a></li><li><a href="/ERTP/guide/getting-started.html" class="sidebar-link">Getting Started</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/ERTP/guide/issuers/" class="sidebar-heading clickable open"><span>Concepts</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ERTP/guide/issuers.html" class="sidebar-link">Issuers</a></li><li><a href="/ERTP/guide/assays.html" class="sidebar-link">Assays</a></li><li><a href="/ERTP/guide/contract-hosts.html" class="active sidebar-link">Contract Hosts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ERTP/guide/contract-hosts.html#contracthost" class="sidebar-link">ContractHost</a></li><li class="sidebar-sub-header"><a href="/ERTP/guide/contract-hosts.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/ERTP/guide/contract-hosts.html#contract" class="sidebar-link">Contract</a></li><li class="sidebar-sub-header"><a href="/ERTP/guide/contract-hosts.html#invitemaker" class="sidebar-link">InviteMaker</a></li><li class="sidebar-sub-header"><a href="/ERTP/guide/contract-hosts.html#collector" class="sidebar-link">Collector</a></li><li class="sidebar-sub-header"><a href="/ERTP/guide/contract-hosts.html#terms" class="sidebar-link">Terms</a></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="contract-hosts"><a href="#contract-hosts" aria-hidden="true" class="header-anchor">#</a> Contract Hosts</h1> <p>ContractHost provides a way to install and run verifiable contracts.</p> <p>Install(source) creates Installations. Installations represent particular
contract forms, which can be spawn()'d to create Contract instances
initialized with specific terms. These Contracts manage invitations for
multiple seats, each of which repesents a &quot;role&quot; in an interaction.</p> <p>Some seats provide the methods <code>getWinnings()</code> and <code>getRefunds()</code>, which return
promises for payments for the outputs of the interaction. We provide the
<code>collect()</code> method (described later) to simplify collection of winnings and
refunds into appropriate purses.</p> <h2 id="contracthost"><a href="#contracthost" aria-hidden="true" class="header-anchor">#</a> ContractHost</h2> <h3 id="contracthost-install-contractsrc"><a href="#contracthost-install-contractsrc" aria-hidden="true" class="header-anchor">#</a> contractHost.install(contractSrc)</h3> <p>ContractSrc is the source code for a Contract. See Contract for details.</p> <ul><li><code>contractSrc</code> <code>{String}</code></li> <li><strong>Returns:</strong> <code>{Installation}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h3 id="contracthost-getinstallationsourcecode-installation"><a href="#contracthost-getinstallationsourcecode-installation" aria-hidden="true" class="header-anchor">#</a> contractHost.getInstallationSourceCode(installation)</h3> <p>Returns the actual source of the Installation.</p> <ul><li><code>installation</code> <code>{Installation}</code></li> <li><strong>Returns:</strong> <code>{String}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h3 id="contracthost-redeem-invite"><a href="#contracthost-redeem-invite" aria-hidden="true" class="header-anchor">#</a> contractHost.redeem(invite)</h3> <p>Seat invitations are packaged as payments from the Invite Assay. Redeeming an invite returns a seat object with an arbitrary interface (the interface is at the discretion of the contract) which supports interaction according to the terms.</p> <ul><li><code>invite</code> <code>{Payment}</code></li> <li><strong>Returns:</strong> <code>{Object}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h3 id="contracthost-getinviteassay"><a href="#contracthost-getinviteassay" aria-hidden="true" class="header-anchor">#</a> contractHost.getInviteAssay()</h3> <p>The assay allows holders of seat invitations to get exclusive access to a Seat.</p> <ul><li><p><strong>Returns:</strong> <code>{Assay}</code></p></li> <li><p><strong>Usage:</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2> <p>An installation of a Contract can spawn multiple copies each with the same or different terms. Each spawned instance has distinct invites and distinct seats representing a specific group of agents interacting according to the same prescribed roles.</p> <p>The Installation can also have functions with names starting <code>check</code>, as defined by the contract. They can be used to validate that the expected terms are actually the same as the terms of this spawned contract. The Installation is inserted by the ContactHost as the first parameter to these functions. The naming restriction is likely to be lifted.</p> <h3 id="installation-spawn-terms"><a href="#installation-spawn-terms" aria-hidden="true" class="header-anchor">#</a> installation.spawn(terms)</h3> <p>Create a new InviteMaker, then call the Contract's start() method and return its results. The results are often a collection of seat invitations for the seats in the contract, but see coveredCall for an exception.</p> <ul><li><code>terms</code> <code>{Terms}</code></li> <li><strong>Returns:</strong> <code>{invites &lt;Object&gt;}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h3 id="installation-checkassetdesc-installation-inviteassetdesc-terms"><a href="#installation-checkassetdesc-installation-inviteassetdesc-terms" aria-hidden="true" class="header-anchor">#</a> installation.checkAssetDesc(installation, inviteAssetDesc, terms)</h3> <p>The writer of the contract can provide methods to help users of the contract verify that the terms of the contract match their expectation. These methods are defined with the installation as the first parameter, so the verifiers can validate that the caller's invitation was issued by the same one. The invocation by clients should omit this parameter, as they will be supplied with a copy of the function with that information already supplied.</p> <p>Users usually want to validate their invitation, the terms of the deal they're attempting to participate in, and which seat they are taking.</p> <ul><li><code>installation</code> <code>{Installation}</code></li> <li><code>inviteAssetDesc</code> <code>{AssetDesc}</code></li> <li><code>terms</code> <code>{Terms}</code></li></ul> <h1 id="no-return-listed-for-this-method"><a href="#no-return-listed-for-this-method" aria-hidden="true" class="header-anchor">#</a> No return listed for this method</h1> <ul><li><strong>Returns:</strong></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h2 id="contract"><a href="#contract" aria-hidden="true" class="header-anchor">#</a> Contract</h2> <p>Contracts are pass-by-text.</p> <p>The ContractHost's install() method is called on the source code for a contract. The contract needs to have a start() method with arguments as described below. Creating the contract object by calling evaluate() on the source code enables the ContractHost to guarantee to its clients that the resulting object implements that specific algorithm, and doesn't have any hidden powers.</p> <p>The form of the 'terms' argument to the contract's start() method is also completely up to the individual contract. It should represent all the information a participant needs in order to know they're participating in the contract they intended. As an example, the 'escrow' contract represents a simple exchange of one bundle of goods for another. Escrow's terms object has the 'assetDesc's to be traded as 'left' and 'right', which correspond to the assetDescs being offered and collected by the respective parties. The Object returned by escrow is an array containing two invitations, but this isn't required. The representation is flexible enough to support trading of money, non-fungible items, or partially-executed positions in other contracts among other possibilities. Other contracts take different paths.</p> <p>Javascript gives access to the source from a function, but not from an object. We make the source accessible to the ContractHost by having contracts export a record containing the source. The contract can also define methods that can be called by participants in the contract to validate that the terms they expect the contract to have been installed with are in agreement with the contract.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> escrowExchangeSrcs <span class="token operator">=</span> <span class="token punctuation">{</span>
  start<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>escrowExchange<span class="token punctuation">.</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  checkAssetDesc<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>escrowExchange<span class="token punctuation">.</span>checkAssetDesc<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="contract-start-terms-invitemaker"><a href="#contract-start-terms-invitemaker" aria-hidden="true" class="header-anchor">#</a> contract.start(terms, inviteMaker)</h3> <p>Start execution of the contract. May return invites for seats.</p> <ul><li><code>terms</code> <code>{Terms}</code></li> <li><code>inviteMaker</code> <code>{InviteMaker}</code></li> <li><strong>Returns:</strong> <code>{Object}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h2 id="invitemaker"><a href="#invitemaker" aria-hidden="true" class="header-anchor">#</a> InviteMaker</h2> <p>An InviteMaker is provided to contracts as a parameter to <code>start()</code>. It allows the contract to issue invitations for seats, arbitrary objects whose interface defines the roles and interactions in the contract. The design of the InviteMaker allows recipients of invites to validate that the invite corresponds to the seat and contract that they expected.
'seatDesc' can be any truthy object, but Strings are convenient. They must be unique for each contract instantiation. 'seat' is an arbitrary object defined by the contract. 'name' is optional; it is used to label the invite payment corresponding to the seat.</p> <h3 id="invitemaker-make-seatdesc-name"><a href="#invitemaker-make-seatdesc-name" aria-hidden="true" class="header-anchor">#</a> inviteMaker.make(seatDesc, name)</h3> <ul><li><code>seatDesc</code> <code>{String}</code></li> <li><code>seat</code> <code>{Objet}</code></li> <li><code>name</code> <code>{String}</code> - The name of an invite payment</li> <li><strong>Returns:</strong> <code>{Purse}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h2 id="collector"><a href="#collector" aria-hidden="true" class="header-anchor">#</a> Collector</h2> <p>collect() calls getWinnings() and 'getRefund()' on seatP and deposits the proceeds respectively into winPurseP and refundPurseP. 'name' (which defaults to 'collecting') is converted to a String, and used for logging the results.</p> <p>'collect()' is a pure function that can be imported from 'contractHost.js'. (Jessie will eventually provide assurances, because of the way that we import modules, that it is confined.)  Since it is confined, users can be sure that it has no ability to skim any of the value being transferred.</p> <p>collect() violates our usual rule of only transferring payments, and never sharing purses. This rule helps us ensure that users don't share a purse when they only intended to share a portion of the contents. We allow collect() to violate the rule because it's such a common pattern.</p> <p>This function is a convenient wrapper that makes it easier to work with our Escrow contract, and has no privileged access.</p> <h3 id="collector-collect-seatp-winpursep-refundpursep-name"><a href="#collector-collect-seatp-winpursep-refundpursep-name" aria-hidden="true" class="header-anchor">#</a> collector.collect(seatP, winPurseP, refundPurseP, name)</h3> <ul><li><code>seatP</code> <code>{Object}</code></li> <li><code>winPurseP</code> <code>{Purse}</code></li> <li><code>refundPurseP</code> <code>{Purse}</code></li> <li><code>name</code> <code>{String}</code></li> <li><strong>Returns:</strong> <code>{winsAndRefunds &lt;Object&gt;}</code></li> <li><strong>Usage:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Examples
</code></pre></div><h2 id="terms"><a href="#terms" aria-hidden="true" class="header-anchor">#</a> Terms</h2> <p>Arbitrary terms defined by each contract.</p> <p>These are defined by the contract, passed to spawn(), and available to be validated in the check methods (or manually by contract participants to ensure they are connected to a contract with matching expectations about what will be traded, and which seat they will occupy.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ERTP/guide/assays.html" class="prev">Assays</a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ERTP/assets/js/app.1981f8d2.js" defer></script><script src="/ERTP/assets/js/2.a50c2bef.js" defer></script><script src="/ERTP/assets/js/12.ea92337c.js" defer></script>
  </body>
</html>
